<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zugangsvoraussetzungen</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="../assets/style.css">

  <style>
    :root {
      --softrot: rgb(228,100,80);
      --drk-gruen: rgb(0,150,80);
      --dunkelblau: rgb(0,45,85);
      --hellblau: rgb(100,160,220);
      --mittelgrau: rgb(180,180,180);
      --blassblau: rgb(230,240,250);
    }

    .page-title {
      color: var(--softrot);
      margin-bottom: 1rem;
    }

    .zugang-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    @media(max-width: 768px){
      .zugang-grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg, #fff);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .card h3 {
      color: var(--hellblau);
      margin-top: 0;
      margin-bottom: 1rem;
      display:flex;
      align-items:center;
      gap:0.5rem;
    }

    /* Checklist */
    .checklist {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .checklist li {
      margin: 0.6rem 0;
      display:flex;
      align-items:center;
      gap:0.5rem;
      font-size:1rem;
    }
    .checklist input[type="checkbox"] {
      width: 1.2rem;
      height: 1.2rem;
      cursor: pointer;
    }

    /* Fortschrittsbalken */
    .progress {
      height: 22px;
      background-color: #e9ecef;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .progress-bar {
      height: 100%;
      text-align: center;
      color: #fff;
      font-size: 0.85rem;
      font-weight: bold;
      transition: width 0.3s ease, background-color 0.3s ease;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .progress-bar.done::after {
      content: " ✅";
      margin-left: 0.3rem;
    }

    /* Moderner Select */
    .form-select {
      position: relative;
      margin-top: 0.5rem;
    }
    .form-select select {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 1px solid var(--mittelgrau);
      border-radius: 8px;
      background: #fff;
      font-size: 1rem;
      appearance: none;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .form-select::after {
      content: "▼";
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.8rem;
      color: var(--dunkelblau);
      pointer-events: none;
    }
    .form-select select:focus {
      outline: none;
      border-color: var(--dunkelblau);
      background: var(--blassblau);
    }
    .selected-user {
      font-weight: bold;
      color: var(--dunkelblau);
      margin-top: 0.8rem;
    }

    /* ===== Modal Style ===== */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-sizing: border-box;
    }
    .modal-content h2 {
      color: var(--dunkelblau); 
      font-size: 1.25rem;
      margin: 0.5rem 0 1.2rem 0;
    }
    .modal-content .form-group {
      position: relative;
      margin-bottom: 1.2rem;
      text-align: left;
    }
    .modal-content .form-group textarea {
      width: 100%;
      border: 1px solid var(--mittelgrau);
      border-radius: 6px;
      padding: 0.9rem 0.8rem 0.5rem 0.8rem;
      font-size: 1rem;
      outline: none;
      background: #fff;
      box-sizing: border-box;
      transition: border-color 0.2s;
      resize: vertical;
      min-height: 80px;
    }
    .modal-content .form-group label {
      position: absolute;
      top: 0.9rem;
      left: 0.9rem;
      font-size: 1rem;
      color: #555;
      pointer-events: none;
      transition: 0.2s ease all;
      background: #fff;
      padding: 0 0.2rem;
    }
    .modal-content .form-group textarea:focus + label,
    .modal-content .form-group textarea:not(:placeholder-shown) + label {
      top: -0.6rem;
      left: 0.6rem;
      font-size: 0.8rem;
      color: var(--dunkelblau);
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1rem;
    }

    .modal-content button {
      flex: 1;
      padding: 0.7rem;
      border: none;
      border-radius: 6px;
      font-size: 0.95rem;
      font-weight: bold;
      cursor: pointer;
    }
    .btn-primary { background: var(--dunkelblau); color: white; }
    .btn-danger { background: var(--softrot); color: white; }
    .btn-success { background: var(--drk-gruen); color: white; }
    .btn-secondary { background: var(--mittelgrau); color: white; }

    /* Toast */
    #toast {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 8px;
      padding: 16px;
      position: fixed;
      z-index: 2000;
      left: 50%;
      bottom: 30px;
      font-size: 1rem;
      opacity: 0;
      transition: opacity 0.5s, bottom 0.5s;
    }
    #toast.show {
      visibility: visible;
      opacity: 1;
      bottom: 50px;
    }
  </style>
</head>
<body>
  <h2 class="page-title">Zugangsvoraussetzungen</h2>

  <!-- Nutzer-Auswahl -->
  <div class="card" style="margin-bottom:1.5rem;">
    <h3><i class="bi bi-people"></i> Nutzer auswählen</h3>
    <div class="form-select">
      <select id="userSelect">
        <option value="">-- bitte wählen --</option>
        <option value="user1">Max Mustermann</option>
        <option value="user2">Anna Beispiel</option>
        <option value="user3">Lukas Test</option>
      </select>
    </div>
    <div id="selectedUser" class="selected-user"></div>
  </div>

  <div class="zugang-grid">
    <!-- Grundvoraussetzungen -->
    <div class="card">
      <h3><i class="bi bi-gear-fill"></i> Grundvoraussetzungen</h3>
      <div class="progress">
        <div id="grund-progress" class="progress-bar" style="width:0%"></div>
      </div>
      <ul class="checklist" id="grund-list">
        <li><input type="checkbox" data-id="fachdienst" disabled> Fachdienstausbildung Sanitätsdienst</li>
        <li><input type="checkbox" data-id="erstgespraech" disabled> Erstgespräch mit Vorstellung des Ausbildungsverlaufs und der IuK Lernwelt</li>
        <li><input type="checkbox" data-id="18jahre" disabled> Vollendung 18. Lebensjahr</li>
        <li><input type="checkbox" data-id="hospitation" disabled> Hospitation 1 Dienst in der Integrierten Leitstelle Bodensee-Oberschwaben</li>
        <li><input type="checkbox" data-id="mitwirken" disabled> min. 2-jähriges aktives Mitwirken im Sanitäts- oder Rettungsdienst</li>
      </ul>
    </div>

    <!-- Optionale Voraussetzungen -->
    <div class="card">
      <h3><i class="bi bi-graph-up"></i> Optionale Voraussetzungen im Verlauf</h3>
      <div class="progress">
        <div id="verlauf-progress" class="progress-bar" style="width:0%"></div>
      </div>
      <ul class="checklist" id="verlauf-list">
        <li><input type="checkbox" data-id="c1" disabled> C1 (Helfer-)Führerschein</li>
        <li><input type="checkbox" data-id="gruppenfuehrer" disabled> Gruppenführer Sanitätsdienst</li>
      </ul>
    </div>
  </div>

  <!-- Bestätigung durch Ausbilder -->
  <div class="card" style="margin-top:1.5rem;">
    <h3><i class="bi bi-person-check"></i> Bestätigung durch Ausbilder</h3>
    <div class="selected-user" id="ausbilderUser">Bitte zuerst Nutzer oben auswählen</div>

    <!-- Grundvoraussetzungen -->
    <div class="checklist" style="margin-top:1rem;">
      <label>
        <input type="checkbox" id="confirmGrund" disabled>
        Alle Grundvoraussetzungen erfüllt
      </label>
      <div id="grundButtons" style="display:none; margin-top:0.8rem;">
        <button class="btn-success" id="approveBtn">Mitglied für aktiven Dienst freigeben</button>
      </div>
    </div>

    <!-- Unabhängige Ablehnung -->
    <div class="checklist" style="margin-top:1rem;">
      <label>
        <input type="checkbox" id="rejectCheck">
        Soll für den aktiven Dienst nicht freigegeben werden
      </label>
      <div id="rejectButtons" style="display:none; margin-top:0.8rem;">
        <button class="btn-danger" id="rejectBtn">Mitglied für aktiven Dienst ablehnen</button>
      </div>
    </div>

    <!-- Optionale Voraussetzungen -->
    <div class="checklist" style="margin-top:1rem;">
      <label>
        <input type="checkbox" id="confirmOptional" disabled>
        Optionale Voraussetzungen im Verlauf erfüllt
      </label>
      <div id="optionalButtons" style="display:none; margin-top:0.8rem;">
        <button class="btn-primary" id="sendOptionalBtn">Bestätigung per Mail senden</button>
      </div>
    </div>
  </div>

  <!-- Popups -->
  <div id="approveModal" class="modal">
    <div class="modal-content">
      <h2>Mitglied freigeben</h2>
      <p>Soll dieses Mitglied wirklich für den aktiven Dienst freigegeben werden?</p>
      <div class="modal-actions">
        <button class="btn-success" id="approveConfirm">Ja, E-Mail senden</button>
        <button class="btn-secondary" onclick="closeModal('approveModal')">Abbrechen</button>
      </div>
    </div>
  </div>

  <div id="rejectModal" class="modal">
    <div class="modal-content">
      <h2>Mitglied ablehnen</h2>
      <div class="form-group">
        <textarea id="rejectReason" placeholder=" "></textarea>
        <label for="rejectReason">Begründung (optional)</label>
      </div>
      <div class="modal-actions">
        <button class="btn-danger" id="rejectConfirm">Ja, E-Mail senden</button>
        <button class="btn-secondary" onclick="closeModal('rejectModal')">Abbrechen</button>
      </div>
    </div>
  </div>

  <div id="optionalModal" class="modal">
    <div class="modal-content">
      <h2>Optionale Voraussetzungen</h2>
      <p>Soll die Bestätigung per Mail verschickt werden?</p>
      <div class="modal-actions">
        <button class="btn-primary" id="optionalConfirm">Ja, E-Mail senden</button>
        <button class="btn-secondary" onclick="closeModal('optionalModal')">Abbrechen</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <script>
    function updateProgress(listId, progressId) {
      const list = document.querySelectorAll(`#${listId} input[type="checkbox"]`);
      const checked = Array.from(list).filter(cb => cb.checked).length;
      const percent = Math.round((checked / list.length) * 100);
      const bar = document.getElementById(progressId);

      bar.style.width = percent + "%";
      bar.textContent = percent > 0 ? percent + "%" : "";

      if (percent === 100) {
        bar.style.backgroundColor = "darkgreen";
        bar.classList.add("done");
      } else if (percent >= 75) {
        bar.style.backgroundColor = "limegreen";
        bar.classList.remove("done");
      } else if (percent >= 50) {
        bar.style.backgroundColor = "gold";
        bar.classList.remove("done");
      } else if (percent >= 25) {
        bar.style.backgroundColor = "orange";
        bar.classList.remove("done");
      } else if (percent > 0) {
        bar.style.backgroundColor = "crimson";
        bar.classList.remove("done");
      } else {
        bar.style.backgroundColor = "#e9ecef";
        bar.classList.remove("done");
      }
      return percent;
    }

    function showToast(message, color = "#333") {
      const toast = document.getElementById("toast");
      toast.innerText = message;
      toast.style.backgroundColor = color;
      toast.className = "show";
      setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
    }

    // Grund & Verlauf Listener
    document.querySelectorAll("#grund-list input").forEach(cb => {
      cb.addEventListener("change", () => updateProgress("grund-list", "grund-progress"));
    });
    document.querySelectorAll("#verlauf-list input").forEach(cb => {
      cb.addEventListener("change", () => updateProgress("verlauf-list", "verlauf-progress"));
    });

    // Nutzer-Auswahl
    const userSelect = document.getElementById("userSelect");
    const selectedUser = document.getElementById("selectedUser");
    const ausbilderUser = document.getElementById("ausbilderUser");

    userSelect.addEventListener("change", () => {
      if (userSelect.value) {
        const name = userSelect.options[userSelect.selectedIndex].text;
        selectedUser.textContent = "Ausgewählt: " + name;
        ausbilderUser.textContent = "Nutzer: " + name;
        document.querySelectorAll("#grund-list input, #verlauf-list input").forEach(cb => cb.disabled = false);
      } else {
        selectedUser.textContent = "";
        ausbilderUser.textContent = "Bitte zuerst Nutzer oben auswählen";
        document.querySelectorAll("#grund-list input, #verlauf-list input").forEach(cb => {
          cb.checked = false;
          cb.disabled = true;
        });
        updateProgress("grund-list", "grund-progress");
        updateProgress("verlauf-list", "verlauf-progress");
      }
    });

    // Grundvoraussetzungen erfüllt
    const confirmGrund = document.getElementById("confirmGrund");
    const grundButtons = document.getElementById("grundButtons");
    confirmGrund.addEventListener("change", () => {
      const grundPercent = updateProgress("grund-list", "grund-progress");
      if (grundPercent === 100) {
        grundButtons.style.display = confirmGrund.checked ? "block" : "none";
      } else {
        confirmGrund.checked = false;
        showToast("❌ Bitte zuerst alle Grundvoraussetzungen abhaken.", "red");
      }
    });

    // Unabhängige Ablehnung
    const rejectCheck = document.getElementById("rejectCheck");
    const rejectButtons = document.getElementById("rejectButtons");
    rejectCheck.addEventListener("change", () => {
      rejectButtons.style.display = rejectCheck.checked ? "block" : "none";
    });

    // Optionale Voraussetzungen erfüllt
    const confirmOptional = document.getElementById("confirmOptional");
    const optionalButtons = document.getElementById("optionalButtons");
    confirmOptional.addEventListener("change", () => {
      const verlaufPercent = updateProgress("verlauf-list", "verlauf-progress");
      if (verlaufPercent === 100) {
        optionalButtons.style.display = confirmOptional.checked ? "block" : "none";
      } else {
        confirmOptional.checked = false;
        showToast("❌ Bitte zuerst alle optionalen Voraussetzungen abhaken.", "red");
      }
    });

    // Popups öffnen
    document.getElementById("approveBtn").addEventListener("click", () => openModal("approveModal"));
    document.getElementById("rejectBtn").addEventListener("click", () => openModal("rejectModal"));
    document.getElementById("sendOptionalBtn").addEventListener("click", () => openModal("optionalModal"));

    function openModal(id) {
      document.getElementById(id).style.display = "flex";
    }
    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }
  </script>
</body>
</html>
