<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IuK Lernwelt – App</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#002D55">
</head>
<body>

  <!-- App Layout -->
  <div class="app-container">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img id="userAvatar" src="assets/avatar-default.png" alt="Avatar">
        <span id="userName">Lädt...</span>
      </div>
      <nav>
        <ul>
          <li><a href="#dashboard" class="active"><i class="bi bi-house"></i> Dashboard</a></li>
          <li><a href="#persoenlich"><i class="bi bi-person"></i> Persönlich</a></li>
          <li><a href="#lernwelt"><i class="bi bi-book"></i> Lernwelt</a></li>
          <li><a href="#hilfe"><i class="bi bi-question-circle"></i> Hilfe</a></li>
          <li><a href="#logout" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main id="mainContent">
      <h1>Willkommen in der IuK Lernwelt</h1>
      <p>Wähle links einen Menüpunkt aus.</p>
    </main>
  </div>

  <!-- Darkmode Klasse -->
  <style>
    body {
      margin:0;
      font-family:sans-serif;
      background:#f4f4f4;
      color:#333;
      display:flex;
      height:100vh;
    }

    .app-container {
      display:flex;
      flex:1;
    }

    .sidebar {
      width:220px;
      background:#fff;
      border-right:1px solid #ddd;
      display:flex;
      flex-direction:column;
    }

    .sidebar-header {
      padding:1rem;
      display:flex;
      flex-direction:column;
      align-items:center;
      border-bottom:1px solid #ddd;
    }

    .sidebar-header img {
      width:70px;
      height:70px;
      border-radius:50%;
      object-fit:cover;
      margin-bottom:0.5rem;
    }

    .sidebar-header span {
      font-weight:bold;
    }

    .sidebar nav ul {
      list-style:none;
      margin:0;
      padding:0;
      flex:1;
    }

    .sidebar nav ul li a {
      display:block;
      padding:0.75rem 1rem;
      text-decoration:none;
      color:#000;
    }

    .sidebar nav ul li a:hover,
    .sidebar nav ul li a.active {
      background:rgb(100,160,220);
      color:#fff;
    }

    main {
      flex:1;
      padding:2rem;
      overflow-y:auto;
    }

    /* Darkmode */
    body.dark {
      background:#121212;
      color:#f0f0f0;
    }
    body.dark .sidebar {
      background:#1e1e1e;
      border-color:#333;
    }
    body.dark .sidebar nav ul li a {
      color:#f0f0f0;
    }
    body.dark .sidebar nav ul li a:hover,
    body.dark .sidebar nav ul li a.active {
      background:rgb(100,160,220);
      color:#fff;
    }
  </style>

  <!-- Scripts -->
  <script type="module">
    import { auth, observeAuthState, logout } from "./js/firebase.js";

    const mainContent = document.getElementById("mainContent");
    const logoutBtn = document.getElementById("logoutBtn");
    const sidebarLinks = document.querySelectorAll(".sidebar nav ul li a");
    const userNameEl = document.getElementById("userName");
    const userAvatarEl = document.getElementById("userAvatar");

    // === Routing ===
    async function loadPage(hash){
      const page = hash.replace("#","");
      if(!page || page==="dashboard"){
        mainContent.innerHTML = "<h1>Dashboard</h1><p>Willkommen zurück!</p>";
        setActive("#dashboard");
        return;
      }
      if(page==="logout"){
        await logout();
        window.location.href="index.html";
        return;
      }
      try {
        const res = await fetch(`pages/${page}.html`);
        const html = await res.text();
        mainContent.innerHTML = html;
        setActive("#"+page);
      } catch(err){
        mainContent.innerHTML = "<h2>❌ Seite nicht gefunden</h2>";
      }
    }

    function setActive(hash){
      sidebarLinks.forEach(link=>{
        if(link.getAttribute("href")===hash){
          link.classList.add("active");
        } else {
          link.classList.remove("active");
        }
      });
    }

    window.addEventListener("hashchange", ()=>loadPage(location.hash));
    loadPage(location.hash || "#dashboard");

    // === Sidebar User Info ===
    observeAuthState((user)=>{
      if(user){
        userNameEl.textContent = user.displayName || user.email.split("@")[0];
        userAvatarEl.src = user.photoURL || "assets/avatar-default.png";
      } else {
        userNameEl.textContent = "Gast";
        userAvatarEl.src = "assets/avatar-default.png";
      }
    });

    // === Darkmode laden ===
    if(localStorage.getItem("theme")==="dark"){
      document.body.classList.add("dark");
    }
  </script>
</body>
</html>
