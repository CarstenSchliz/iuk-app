<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>IuK Lernwelt – App</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#002D55">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    body{margin:0;font-family:Arial,sans-serif;display:flex;height:100vh;background:#efeeea;overflow:hidden;}
    .sidebar{background:rgba(0,45,85,0.9);backdrop-filter:blur(14px);color:white;width:260px;display:flex;flex-direction:column;padding:1.5rem 1rem;box-sizing:border-box;}
    .profile{text-align:center;margin-bottom:2rem;}
    .profile img{width:100px;aspect-ratio:1/1;border-radius:50%;object-fit:cover;border:2px solid white;display:block;margin:0 auto 0.8rem auto;background:#ccc;cursor:pointer;}
    .menu{flex-grow:1;}
    .menu button,.logout{display:flex;align-items:center;gap:0.75rem;width:100%;padding:0.6rem 1rem;background:transparent;border:none;color:white;font-size:1rem;cursor:pointer;text-align:left;border-radius:8px;margin-bottom:0.5rem;transition:background 0.2s;}
    .menu button:hover,.logout:hover{background:rgba(255,255,255,0.15);}
    .logout{margin-top:auto;margin-bottom:0.8rem;}
    .version{font-size:0.8rem;text-align:center;color:#ccc;}
    .content{flex-grow:1;background:#efeeea;padding:2rem 3rem;overflow-y:auto;}
    @media(max-width:768px){.sidebar{position:fixed;left:-260px;top:0;height:100%;transition:left 0.3s;z-index:1000;}.sidebar.active{left:0;}
      .menu-toggle{position:fixed;top:1rem;left:1rem;font-size:1.5rem;background:#002d55;color:white;border:none;padding:0.5rem 0.8rem;border-radius:8px;cursor:pointer;z-index:1100;}
      .content{padding:5rem 1.5rem 2rem 1.5rem;}
    }
  </style>
</head>
<body>
  <button class="menu-toggle" id="menuToggle"><i class="bi bi-list"></i></button>
  <div class="sidebar" id="sidebar">
    <div class="profile">
      <img src="assets/profile-placeholder.png" alt="Profilbild" id="profileImg">
      <input type="file" id="profileUpload" accept="image/*" style="display:none;">
      <h2 id="username">…</h2>
      <p>Teilnehmer</p>
    </div>
    <div class="menu">
      <button data-page="persoenlich"><i class="bi bi-person"></i> Persönliche Daten</button>
      <button data-page="zugang"><i class="bi bi-key"></i> Zugangsvoraussetzungen</button>
      <button data-page="dashboard"><i class="bi bi-speedometer2"></i> Dashboard</button>
      <button data-page="module"><i class="bi bi-journal"></i> Lernmodule</button>
      <button data-page="materialien"><i class="bi bi-folder2"></i> Lernmaterialien</button>
      <button data-page="benutzer"><i class="bi bi-people"></i> Benutzerverwaltung</button>
    </div>
    <button class="logout" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</button>
    <div class="version">Version 1.0.0</div>
  </div>
  <div class="content" id="content"><h1>Willkommen in der IuK Lernwelt</h1><p>Bitte wähle links einen Menüpunkt aus.</p></div>

  <script type="module">
    import { auth, storage } from "./firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

    const menuToggle=document.getElementById("menuToggle");
    const sidebar=document.getElementById("sidebar");
    menuToggle.addEventListener("click",()=>sidebar.classList.toggle("active"));

    const content=document.getElementById("content");
    document.querySelectorAll(".menu button").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const page=btn.getAttribute("data-page");
        content.innerHTML="<h2>"+btn.innerText+"</h2><p>Inhalt für "+btn.innerText+" kommt hier hin.</p>";
        sidebar.classList.remove("active");
      });
    });

    const profileImg=document.getElementById("profileImg");
    const profileUpload=document.getElementById("profileUpload");
    profileImg.addEventListener("click",()=>profileUpload.click());
    profileUpload.addEventListener("change",async e=>{
      const file=e.target.files[0];
      if(file&&auth.currentUser){
        try{
          const storageRef=ref(storage,"profilePics/"+auth.currentUser.uid);
          await uploadBytes(storageRef,file);
          let url=await getDownloadURL(storageRef);
          url=url+"?t="+new Date().getTime();
          profileImg.src=url;
          alert("Profilbild erfolgreich hochgeladen!");
        }catch(err){alert("Fehler beim Hochladen: "+err.message);}
      }
    });

    document.getElementById("logoutBtn").addEventListener("click",async()=>{
      await signOut(auth); window.location.href="index.html";
    });

    onAuthStateChanged(auth,async user=>{
      if(!user){window.location.href="index.html";}
      else{
        document.getElementById("username").innerText=user.displayName||user.email;
        try{
          const storageRef=ref(storage,"profilePics/"+user.uid);
          let url=await getDownloadURL(storageRef);
          url=url+"?t="+new Date().getTime();
          profileImg.src=url;
        }catch{}
      }
    });
  </script>
</body>
</html>
